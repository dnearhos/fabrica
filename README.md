# fabrica
Open source device connectivity framework for Robotics and IoT devices

Fabrica is intended as a starter famework to enable the creation of networks of devices that exchange data and instructions. This fabrica program uses a central exchange autotron6.com to enable connectivity.

The autotron6 framework is intended for smart robotic (or other edge based device) to exchange data and receive broad based instructions. It is intended that the local device incorporate this information to make a determination locally as to the best course of action for the device.

This fabrica program is written in Python3 and is intended for a Unix based system such as a Raspberry Pi or other variant. It is intended that the base fabrica framework be extended into other systems (e.g. servers, embedded microcontrollers, ...).


MATERIALS REQUIRED:

- Raspberry Pi
- autotron6.com account


OUTLINE OF INITIAL SETUP:

Autotron6.com setup
1) Login to autotron6 and create a new device

Device setup (e.g. Raspberry Pi)
1) Copy the fabrica.py program and associated .json files to a location on your raspberry pi with Python3 installed
2) Copy the <device id> generated by the server for your new device and paste this <device id> into your <connect.json> file on your raspbery pi
3) Run the fabrica program with the command "python3 fabrica.py"
4) Initialise this device with the "i" command - this will generate a unique id for the new device and initiate communication with autotron6 server via a REST API. If successfull the device will update the unique id on the autotron6 server and the device will recieve a security token that can be used to initiate the next round of communication.
5) Sync the device with the "s" command - this will send data in the <output_data.json> file and recieve data and instructions in a new <input_data.json> file via the autotron6 REST API for message exchange
6) Process any actions received from the server with the "p" command - this command triggers the device to locally process any actions that were received via the <input_data.json> file.


OUTLINE OF CREATING DEVICE ACTION TRIGGERS:

Autotron6.com resources
1) Logon to the autotron6 platform and edit the desired resource
2) Create one or more new actions (see formats for <input>, <output>, <trigger> and <action>)

Device development
1) Modify fabrica.py in the section "Initiate Local Device Functions Here" to read the actions and data received from the server. These actions are located in the <input_data.json> file under "data_json" - "actions" and "data"


OUTLINE OF TRIGGER FORMATS on autotron6.com:

Example Action Trigger

Name:
"Frost Guard"

Input:
"{"input": [{"name":"frost_guard_temp", "device_id": "LOCAL", "value": 5}, {"name": "temp", "device_id": "WS1", "value": "temprature"}]}"

Output:
"{"output": [{"name":"device_on_time", "device_id": "LOCAL", "value": 60}, {"name": "temp", "device_id": "WS1", "value": "temprature"}]}"

Trigger:
"{"if": ["temp", "<", "frost_guard_temp"]}"

Action:
{"action": ["turn_pump_on"]}


Frost Guard example explained:

The above "Frost Guard" example is a simple device action for a "pump" device that is looking for changes in temprature from a device with the <device_id> "WS1". This device action will trigger a 60 second watering when the temprature drops below 5 degrees. Lets start with outcome then work back to the input...

Action: There is one action in the array that will be processed by the local device "turn_pump_on" that will be sent back to the device when the trigger condition is met. Multiple actions may be initiated by providing more in the action aray e.g. {"action": ["turn_pump_on", "wake_up_farmer", "initiate_drone_flyover"]}

Trigger: The trigger sets the condiiton that when true will provide the "Action" and "Output" data back to the device. The trigger is evaluated at the time the device is synchronising with server. Note that at this stage only one trigger condition can be met and sent in a communication cycle. 

Output: Output defines that data that will be sent back to the device, this data will be recieved in the input_data.json file on the device if the trigger condition is met. Output declares a local variable "device_on_time" and assigns a value of 60. It then declares another variable "temp" (for temprature) and assigns this from data received from another device with the device_id of "WS1" where it is declared as "temprature". This is used to send the WS1 temprature data to the pump device (however the Fabrica program ignores this information). Note that you can only access data from other devices that you have setup on the autotron6 platform.

Input: Input fields are used to evaluate the trigger condition. This input example declares a local variable "frost_guard_temp" and assigns a value of 5. It then declares another variable "temp" (for temprature) and assigns this from data received from another device with the device_id of "WS1" where it is declared as "temprature". These input field must be used to define any variables used in the trigger condition statement, in this case they are "temp" and "frost_guard_temp". Note that you can only access data from other devices that you have setup on the autotron6 platform.
